import{u as z}from"./useAsyncValidator-D-1iyTRV.js";import{_ as x,a as I,b as C,c as N}from"./Form.layout.vue_vue_type_script_setup_true_lang-BB3z9VPA.js";import{_ as j}from"./Form.select.vue_vue_type_script_setup_true_lang-DrgtBE1i.js";import{d as A,p as F,g as v}from"./request.helper-BUxsD2As.js";import{ad as D,d as h,a5 as O,a3 as P,w,f as S,D as U,o as b,c as L,i,h as u,u as t,j as _,t as m,b as d,a as $,F as M,g as T}from"./index-BC3jgjxj.js";import{r as q}from"./util.object-9m6X7yey.js";import{v as G}from"./v4-CQkTLCs1.js";import{r as H}from"./assignment-B9G-z40K.js";import"./index-BMenrDxa.js";import"./form-B9B7fpoT.js";import"./keyboard-BRUDIerL.js";import"./EyeIcon-DFMnCOVI.js";import"./ChevronDownIcon-7gZ8P6ow.js";import"./enum-CD4clsnU.js";const B={roleId:"-1",permissionId:"-1",enable:!0},l=D({...B}),V=h([]),p=h([]),n=h([]);function J(e){return!!p.value.find(a=>a.id===e.id)}function K(e){const a=n.value.map(o=>o.id).indexOf(e.id);a!==-1?n.value.splice(a,1):n.value.push(e)}const Q=async()=>{p.value.forEach(async e=>{e.assignments.forEach(async a=>{await A("/api/assignments/"+a.id,e)===void 0&&O("500: Server Error")})}),n.value.forEach(async e=>{const a={id:G(),roleId:l.roleId,permissionId:e.id,enable:!0},o=await F("/api/assignments",a);o!=null&&o.data&&(P(o.message),q(l,B))})};w(()=>l.roleId,e=>{e!=="-1"?(n.value=[],v("/api/permissions/byroleid/"+e).then(a=>{p.value=(a==null?void 0:a.data)||[]})):(p.value=[],n.value=[])});w(p,e=>{n.value=[...e]},{deep:!0});const R={class:"flex flex-col gap-2"},W=["for"],X={class:"border border-gray-100 relative dark:border-zinc-900 rounded-md"},Y=["checked","onChange","disabled","value","id"],Z={class:"flex justify-between px-4 py-2 bg-gray-100 peer-checked:bg-cerulean-100 dark:peer-checked:!bg-slate-950 dark:bg-zinc-950"},ee={class:"flex gap-x-1 items-center capitalize text-gray-950 text-sm font-semibold dark:text-gray-50"},ae={class:"border-t border-gray-100 bg-gray-50 px-4 dark:border-zinc-900 py-2 text-xs text-gray-600 peer-checked:bg-cerulean-50 dark:bg-zinc-800 dark:text-gray-300 dark:peer-checked:!bg-slate-900"},ge=S({__name:"AssignmentAddView",props:{hasError:{}},setup(e){const{pass:a,errorFields:o}=z(l,H),y=h([]);return U(()=>{v("/api/roles").then(r=>{y.value=(r==null?void 0:r.data)||[]}),v("/api/permissions").then(r=>{V.value=(r==null?void 0:r.data)||[]})}),(r,f)=>(b(),L(N,{submit:t(Q)},{default:i(()=>[u(x,null,{default:i(()=>{var s,c;return[u(I,{"has-error":[!!((c=(s=t(o))==null?void 0:s.roleId)!=null&&c.length)]},{heading:i(()=>[_(m(r.$t("form.role")),1)]),content:i(()=>{var g,k;return[u(j,{modelValue:t(l).roleId,"onUpdate:modelValue":f[0]||(f[0]=E=>t(l).roleId=E),list:y.value,"has-error":!!((k=(g=t(o))==null?void 0:g.roleId)!=null&&k.length),placeholder:r.$t("form.place_holder.role_id")},{default:i(()=>[_(m(r.$t("form.role")),1)]),_:1},8,["modelValue","list","has-error","placeholder"])]}),_:1},8,["has-error"])]}),_:1}),u(x,null,{default:i(()=>[u(C,{modelValue:t(l).enable,"onUpdate:modelValue":f[1]||(f[1]=s=>t(l).enable=s),pass:t(a)},null,8,["modelValue","pass"]),u(I,{"has-error":[!1]},{heading:i(()=>[_(m(r.$t("form.permission")),1)]),content:i(()=>[d("ul",R,[(b(!0),$(M,null,T(t(V),(s,c)=>(b(),$("li",{key:c},[d("label",{for:`checkbox-${c}`},[d("div",X,[d("input",{checked:t(J)(s),onChange:g=>t(K)(s),disabled:t(l).roleId==="-1",class:"absolute top-2 right-4 w-4 h-4 peer text-cerulean-600 bg-gray-100 border-gray-300 rounded checked:accent-cerulean-600",type:"checkbox",value:s,id:`checkbox-${c}`},null,40,Y),d("div",Z,[d("div",ee,m(s.type),1)]),d("div",ae,m(s.value),1)])],8,W)]))),128))])]),_:1})]),_:1})]),_:1},8,["submit"]))}});export{ge as default};
